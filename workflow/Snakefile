import pathlib
import shutil

from snakemake.utils import validate

container: 'docker://votti/miniconda3mamba:mamba0.3.0'

# Define dependency on preprocessing workflows
subworkflow phys_preproc:
    workdir:
        "../../phys_preproc"
    snakefile:
        "../../phys_preproc/workflow/Snakefile"

# Read Configuration
configfile: 'config/config_phys_analysis.yml'
validate(config, "schemas/config_phys_analysis.schema.yml")

# Extract variables from configuration
## Input/output
fol_results = pathlib.Path('results')
fol_resources = pathlib.Path('resources')
fol_sp_config = fol_resources / 'spherpro_config'
fn_panel_src = '../phys_preproc/config/panel.csv'
fn_panel = fol_sp_config / 'panel.csv'
# Target rules
rule all:
    input: fn_panel

rule get_panel:
    input: fn_panel_src
    output: fn_panel
    run:
        shutil.copy(input[0], output[0])

rule
# Varia
rule sync_to_cluster:
    shell:
         'rsync -rtu /home/vitoz/mnt/tmp/scratch/vitoz/Git/SpheroidPublication/analysis/phys vizano@cluster.s3it.uzh.ch:/data/vizano/Git/SpheroidPublication/analysis --progress --exclude=".*" --exclude="pkgs/" --exclude=".snakemake" --exclude="results/"'

rule sync_from_cluster:
    shell:
         'rsync -rtu vizano@cluster.s3it.uzh.ch:/data/vizano/Git/SpheroidPublication/analysis/phys /home/vitoz/mnt/tmp/scratch/vitoz/Git/SpheroidPublication/analysis  --progress --exclude=".*" --exclude="phys/resources" --exclude "phys/pkgs"'
rule clean:
    shell:
        "rm -R {folder_base}"

# Data retrieval
